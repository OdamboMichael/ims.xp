{% extends 'base.html' %}
{% load static %}

{% block title %}General Settings - Xpert Farmer IMS{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <!-- Sidebar Navigation -->
        <div class="col-md-3 col-lg-2 d-md-block sidebar">
            <div class="position-sticky pt-3">
                <ul class="nav flex-column">
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'dashboard:home' %}">
                            <i class="fas fa-tachometer-alt me-2"></i>Dashboard
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'users:list' %}">
                            <i class="fas fa-users me-2"></i>Users
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="{% url 'settings:account' %}">
                            <i class="fas fa-cog me-2"></i>Settings
                        </a>
                    </li>
                </ul>
                
                <!-- Settings Submenu -->
                <div class="mt-4">
                    <h6 class="sidebar-heading px-3 mb-2">Settings</h6>
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link" href="{% url 'settings:account' %}">
                                <i class="fas fa-user-cog me-2"></i>Account
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{% url 'settings:profile' %}">
                                <i class="fas fa-user me-2"></i>Profile
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{% url 'settings:institution' %}">
                                <i class="fas fa-building me-2"></i>Institution
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link active" href="{% url 'settings:general' %}">
                                <i class="fas fa-sliders-h me-2"></i>General
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
            <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                <h1 class="h2">General Settings</h1>
                <div class="btn-toolbar mb-2 mb-md-0">
                    <button type="button" class="btn btn-sm btn-outline-secondary" onclick="restoreDefaults()">
                        <i class="fas fa-undo me-1"></i>Restore Defaults
                    </button>
                </div>
            </div>

            <!-- Application Settings -->
            <div class="row">
                <div class="col-lg-6">
                    <!-- Display Settings Card -->
                    <div class="card mb-4">
                        <div class="card-header">
                            <h5 class="mb-0">Display Settings</h5>
                        </div>
                        <div class="card-body">
                            <div class="mb-3">
                                <label class="form-label">Theme</label>
                                <select class="form-select">
                                    <option value="light" selected>Light Theme</option>
                                    <option value="dark">Dark Theme</option>
                                    <option value="auto">Auto (System)</option>
                                </select>
                            </div>
                            
                            <div class="mb-3">
                                <label class="form-label">Language</label>
                                <select class="form-select">
                                    <option value="en-us" selected>English (United States)</option>
                                    <option value="en-gb">English (United Kingdom)</option>
                                    <option value="es">Spanish</option>
                                    <option value="fr">French</option>
                                    <option value="sw">Swahili</option>
                                    <option value="pt">Portuguese</option>
                                </select>
                            </div>
                            
                            <div class="mb-3">
                                <label class="form-label">Time Format</label>
                                <select class="form-select">
                                    <option value="12h" selected>12-hour (AM/PM)</option>
                                    <option value="24h">24-hour</option>
                                </select>
                            </div>
                            
                            <div class="mb-3">
                                <label class="form-label">Date Format</label>
                                <select class="form-select">
                                    <option value="mm/dd/yyyy" selected>MM/DD/YYYY</option>
                                    <option value="dd/mm/yyyy">DD/MM/YYYY</option>
                                    <option value="yyyy-mm-dd">YYYY-MM-DD</option>
                                </select>
                            </div>
                            
                            <div class="mb-3">
                                <label class="form-label">Number Format</label>
                                <select class="form-select">
                                    <option value="1,000.00" selected>1,000.00 (US)</option>
                                    <option value="1.000,00">1.000,00 (EU)</option>
                                    <option value="1000.00">1000.00 (Plain)</option>
                                </select>
                            </div>
                            
                            <div class="mb-3">
                                <label class="form-label">Currency</label>
                                <select class="form-select">
                                    <option value="usd" selected>US Dollar ($)</option>
                                    <option value="eur">Euro (€)</option>
                                    <option value="gbp">British Pound (£)</option>
                                    <option value="kes">Kenyan Shilling (KSh)</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Data & Storage Card -->
                    <div class="card mb-4">
                        <div class="card-header">
                            <h5 class="mb-0">Data & Storage</h5>
                        </div>
                        <div class="card-body">
                            <div class="mb-3">
                                <label class="form-label">Data Retention Period</label>
                                <select class="form-select">
                                    <option value="1">1 year</option>
                                    <option value="3" selected>3 years</option>
                                    <option value="5">5 years</option>
                                    <option value="10">10 years</option>
                                    <option value="forever">Forever</option>
                                </select>
                                <div class="form-text">How long to keep historical data before automatic deletion</div>
                            </div>
                            
                            <div class="mb-3">
                                <label class="form-label">Auto-backup Frequency</label>
                                <select class="form-select">
                                    <option value="daily" selected>Daily</option>
                                    <option value="weekly">Weekly</option>
                                    <option value="monthly">Monthly</option>
                                    <option value="never">Never</option>
                                </select>
                            </div>
                            
                            <div class="mb-3">
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="autoExport" checked>
                                    <label class="form-check-label" for="autoExport">
                                        Auto-export reports to cloud storage
                                    </label>
                                </div>
                            </div>
                            
                            <div class="mb-3">
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="dataCompression">
                                    <label class="form-check-label" for="dataCompression">
                                        Compress old data to save storage
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="col-lg-6">
                    <!-- Notification Settings Card -->
                    <div class="card mb-4">
                        <div class="card-header">
                            <h5 class="mb-0">Notifications</h5>
                        </div>
                        <div class="card-body">
                            <div class="mb-3">
                                <label class="form-label">Notification Methods</label>
                                <div class="border rounded p-3">
                                    <div class="form-check mb-2">
                                        <input class="form-check-input" type="checkbox" id="notifyEmail" checked>
                                        <label class="form-check-label" for="notifyEmail">
                                            Email notifications
                                        </label>
                                    </div>
                                    <div class="form-check mb-2">
                                        <input class="form-check-input" type="checkbox" id="notifyBrowser">
                                        <label class="form-check-label" for="notifyBrowser">
                                            Browser notifications
                                        </label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="notifyMobile">
                                        <label class="form-check-label" for="notifyMobile">
                                            Mobile push notifications
                                        </label>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="mb-3">
                                <label class="form-label">Notification Categories</label>
                                <div class="border rounded p-3">
                                    <div class="form-check mb-2">
                                        <input class="form-check-input" type="checkbox" id="notifyDataUpdates" checked>
                                        <label class="form-check-label" for="notifyDataUpdates">
                                            Data Updates - Receive as email when new farm data is available
                                        </label>
                                    </div>
                                    <div class="form-check mb-2">
                                        <input class="form-check-input" type="checkbox" id="notifyNewReports" checked>
                                        <label class="form-check-label" for="notifyNewReports">
                                            New Reports - Get notified when new reports are generated
                                        </label>
                                    </div>
                                    <div class="form-check mb-2">
                                        <input class="form-check-input" type="checkbox" id="notifySystemAlerts">
                                        <label class="form-check-label" for="notifySystemAlerts">
                                            System Alerts - System maintenance and updates
                                        </label>
                                    </div>
                                    <div class="form-check mb-2">
                                        <input class="form-check-input" type="checkbox" id="notifySecurity">
                                        <label class="form-check-label" for="notifySecurity">
                                            Security - Login alerts and security events
                                        </label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="notifyMarketing">
                                        <label class="form-check-label" for="notifyMarketing">
                                            Marketing - Product updates and newsletters
                                        </label>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="mb-3">
                                <label class="form-label">Notification Frequency</label>
                                <select class="form-select">
                                    <option value="realtime" selected>Real-time</option>
                                    <option value="hourly">Hourly digest</option>
                                    <option value="daily">Daily digest</option>
                                    <option value="weekly">Weekly summary</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Privacy & Security Card -->
                    <div class="card">
                        <div class="card-header">
                            <h5 class="mb-0">Privacy & Security</h5>
                        </div>
                        <div class="card-body">
                            <div class="mb-3">
                                <label class="form-label">Data Sharing</label>
                                <select class="form-select">
                                    <option value="none" selected>Do not share any data</option>
                                    <option value="anonymous">Share anonymous usage data</option>
                                    <option value="aggregated">Share aggregated, non-personal data</option>
                                </select>
                                <div class="form-text">Help us improve by sharing usage data</div>
                            </div>
                            
                            <div class="mb-3">
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="analytics" checked>
                                    <label class="form-check-label" for="analytics">
                                        Enable usage analytics
                                    </label>
                                </div>
                            </div>
                            
                            <div class="mb-3">
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="cookies">
                                    <label class="form-check-label" for="cookies">
                                        Accept cookies
                                    </label>
                                </div>
                            </div>
                            
                            <div class="mb-3">
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="GDPR">
                                    <label class="form-check-label" for="GDPR">
                                        GDPR compliance mode
                                    </label>
                                </div>
                            </div>
                            
                            <div class="mb-3">
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="privacyMode">
                                    <label class="form-check-label" for="privacyMode">
                                        Privacy mode (hide sensitive data)
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Save Settings Button -->
            <div class="card mt-4">
                <div class="card-body text-center">
                    <div class="row justify-content-center">
                        <div class="col-md-8">
                            <h5 class="mb-3">Apply Settings Changes</h5>
                            <p class="text-muted mb-4">Your changes will be applied immediately. Some settings may require a page refresh to take effect.</p>
                            <div class="d-flex justify-content-center gap-3">
                                <button type="button" class="btn btn-secondary" onclick="testSettings()">
                                    <i class="fas fa-vial me-1"></i>Test Settings
                                </button>
                                <button type="button" class="btn btn-primary" onclick="saveGeneralSettings()">
                                    <i class="fas fa-save me-1"></i>Save All Settings
                                </button>
                                <button type="button" class="btn btn-success" onclick="applyAndRefresh()">
                                    <i class="fas fa-sync-alt me-1"></i>Apply & Refresh
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Advanced Settings -->
            <div class="card mt-4">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-cogs me-2"></i>Advanced Settings
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label class="form-label">API Access</label>
                                <select class="form-select">
                                    <option value="disabled" selected>Disabled</option>
                                    <option value="readonly">Read-only</option>
                                    <option value="full">Full Access</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label class="form-label">Cache Duration</label>
                                <select class="form-select">
                                    <option value="5">5 minutes</option>
                                    <option value="15">15 minutes</option>
                                    <option value="30" selected>30 minutes</option>
                                    <option value="60">1 hour</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label class="form-label">Log Level</label>
                                <select class="form-select">
                                    <option value="error">Error Only</option>
                                    <option value="warn">Warnings</option>
                                    <option value="info" selected>Info</option>
                                    <option value="debug">Debug</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">Custom CSS (Advanced)</label>
                        <textarea class="form-control" rows="3" placeholder="Enter custom CSS rules..."></textarea>
                        <div class="form-text">For advanced users only. Invalid CSS may break the interface.</div>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">Custom JavaScript (Advanced)</label>
                        <textarea class="form-control" rows="3" placeholder="Enter custom JavaScript..."></textarea>
                        <div class="form-text">For advanced users only. Use with caution.</div>
                    </div>
                    
                    <div class="text-end">
                        <button type="button" class="btn btn-outline-warning" onclick="clearCache()">
                            <i class="fas fa-broom me-1"></i>Clear Cache
                        </button>
                        <button type="button" class="btn btn-outline-info" onclick="viewSystemLogs()">
                            <i class="fas fa-file-alt me-1"></i>View System Logs
                        </button>
                        <button type="button" class="btn btn-outline-danger" onclick="resetAdvancedSettings()">
                            <i class="fas fa-trash me-1"></i>Reset Advanced
                        </button>
                    </div>
                </div>
            </div>
        </main>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Load saved settings if available
        const savedSettings = localStorage.getItem('xpertFarmerSettings');
        if (savedSettings) {
            const settings = JSON.parse(savedSettings);
            // Apply saved settings to form elements
            // This would need to be customized based on your actual form structure
        }
    });

    function restoreDefaults() {
        if (confirm('Restore all settings to defaults? This cannot be undone.')) {
            // Reset all form elements to default values
            document.querySelectorAll('select').forEach(select => {
                if (select.querySelector('option[selected]')) {
                    select.value = select.querySelector('option[selected]').value;
                }
            });
            
            document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
                checkbox.checked = checkbox.defaultChecked;
            });
            
            document.querySelectorAll('input[type="radio"]').forEach(radio => {
                radio.checked = radio.defaultChecked;
            });
            
            document.querySelectorAll('textarea').forEach(textarea => {
                textarea.value = textarea.defaultValue;
            });
            
            alert('All settings restored to defaults!');
        }
    }

    function testSettings() {
        alert('Testing settings... This would validate and test your configuration.');
    }

    function saveGeneralSettings() {
        // Collect all settings
        const settings = {
            theme: document.querySelector('select').value,
            language: document.querySelectorAll('select')[1].value,
            // Add more settings collection here
        };
        
        // Save to localStorage
        localStorage.setItem('xpertFarmerSettings', JSON.stringify(settings));
        
        alert('Settings saved successfully!');
    }

    function applyAndRefresh() {
        saveGeneralSettings();
        setTimeout(() => {
            window.location.reload();
        }, 1000);
    }

    function clearCache() {
        if (confirm('Clear all cached data? This may slow down initial load.')) {
            localStorage.removeItem('xpertFarmerSettings');
            alert('Cache cleared successfully!');
        }
    }

    function viewSystemLogs() {
        alert('Opening system logs...');
    }

    function resetAdvancedSettings() {
        if (confirm('Reset all advanced settings to defaults?')) {
            document.querySelectorAll('textarea').forEach(textarea => {
                textarea.value = '';
            });
            
            document.querySelectorAll('.advanced-select').forEach(select => {
                select.value = select.querySelector('option[selected]')?.value || '';
            });
            
            alert('Advanced settings reset!');
        }
    }
</script>
{% endblock %}